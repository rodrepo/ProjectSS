@using ProjectSS.Web.Models
@using ProjectSS.Common
@model ProposalViewModel
@{
    ViewBag.Title = "Manage";
    Layout = "~/Views/Shared/_Layout.cshtml";
    var canAccessOM = User.IsInRole(RoleType.OM.ToString());
    var canAccessBD = User.IsInRole(RoleType.BD.ToString());
}
<div class="panel panel-default">
    <div class="panel-heading">
        <div class="col-sm-12">
            <div class="col-sm-6">
                <h4>CMR NUMBER</h4>
            </div>
            <div class="col-sm-6">
                <div class="pull-right" style="padding-top:10px">
                    @if (canAccessOM == true || canAccessBD == true)
                    {
                        <button type="submit" class="btn btn-success btn-xs">Update</button>
                    }
                    @if (canAccessOM == true)
                    {
                        <button type="button" data-toggle="modal" data-target="#deletemodal" class="btn btn-danger btn-xs">Delete</button>
                    }
                    &nbsp;<a type="button" class="btn btn-info btn-xs" href="@Url.Action("Index", "Proposal")">Back</a>
                </div>
            </div>
        </div>
    </div>
    <br>
    <div class="panel-body">
        <form role="form">
            <div class="form-group col-sm-3">
                <label>Title</label>
                @Html.TextBoxFor(model => model.Title, new { @class = "form-control", @type = "text", @required = "required", @placeholder = "Enter Proposal Title" })
                @Html.ValidationMessageFor(model => model.Title, "", new { @class = "text-danger" })
            </div>
            <div class="form-group col-sm-3">
                <label>Company Name</label>
                @Html.TextBoxFor(model => model.CompanyName, new { @class = "form-control", @readonly = "readonly" })
                @Html.ValidationMessageFor(model => model.CompanyName, "", new { @class = "text-danger" })
            </div>
            <div class="form-group col-sm-3">
                <label>Contact Person</label>
                @Html.TextBoxFor(model => model.ContactPerson, new { @class = "form-control", @readonly = "readonly" })
                @Html.ValidationMessageFor(model => model.ContactPerson, "", new { @class = "text-danger" })
            </div>
            <div class="form-group col-sm-3">
                <label>Position</label>
                @Html.TextBoxFor(model => model.ContactPersonPosition, new { @class = "form-control", @readonly = "readonly" })
                @Html.ValidationMessageFor(model => model.ContactPersonPosition, "", new { @class = "text-danger" })
            </div>
            <div class="form-group col-sm-4">
                <label>Industry</label>
                @Html.TextBoxFor(model => model.Industry, new { @class = "form-control", @readonly = "readonly" })
                @Html.ValidationMessageFor(model => model.Industry, "", new { @class = "text-danger" })
            </div>
            <div class="form-group col-sm-4">
                <label>Location</label>
                @Html.TextBoxFor(model => model.Location, new { @class = "form-control", @readonly = "readonly" })
                @Html.ValidationMessageFor(model => model.Location, "", new { @class = "text-danger" })
            </div>
            <div class="form-group col-sm-4">
                <label>Project Cost</label>
                @Html.TextBoxFor(model => model.Cost, "0.00", new { @class = "form-control", @type = "text", @required = "required" })
                @Html.ValidationMessageFor(model => model.Cost, "", new { @class = "text-danger" })
            </div>
            <div class="form-group col-sm-12">
                <label>Description</label>
                @Html.TextAreaFor(model => model.Description, new { @class = "form-control", @row = "3", @required = "required", @placeholder = "Enter Description" })
                @Html.ValidationMessageFor(model => model.ContactPerson, "", new { @class = "text-danger" })
            </div>
            <div class="form-group col-sm-4">
                <label>Business Developement</label>
                @Html.DropDownListFor(model => model.BDId, (List<SelectListItem>)ViewBag.BDs, new { @class = "form-control", @disabled = "disabled" })
            </div>
            <div class="form-group col-sm-4">
                <label>Technical Head</label>
                @Html.DropDownListFor(model => model.THId, (List<SelectListItem>)ViewBag.THs, new { @class = "form-control", @disabled = "disabled" })
            </div>
            <div class="form-group col-sm-4">
                <label>Technical Specialist</label>
                @Html.DropDownListFor(model => model.TSId, (List<SelectListItem>)ViewBag.TSs, new { @class = "form-control", @disabled = "disabled" })
            </div>
        </form>
    </div>
</div>
<div class="panel panel-default">
    <div class="panel-heading">
        <div class="col-sm-12">
            <div class="col-sm-6">
                <h4>STAFF</h4>
            </div>
            <div class="col-sm-6">
                <div class="pull-right" style="padding-top:10px">
                    @if (canAccessOM == true || canAccessBD == true)
                    {
                        <button type="submit" data-toggle="modal" data-target="#createStaff"  class="btn btn-success btn-xs">New</button>
                    }
                </div>
            </div>
        </div>
    </div>
    <br />
    <div class="panel-body">
        <table id="datatable" class="table table-striped table-hover">
            <thead>
                <tr>
                    <th>NANE</th>
                    <th>MAN-HOURS</th>
                    <th>MAN-MONTHS</th>
                    <th>TOTAL MANHOURS</th>
                    <th>BILLING RATE</th>
                    <th>DIRECT COST</th>
                    <th>FACTOR</th>
                    <th>BILLED TO CLIENT</th>
                    <th></th>
                </tr>
            </thead>
            <tbody>
                @if (Model != null)
                {
                    foreach (var u in Model.ProposalStaffs)
                    {
                        <tr>
                            <td>@u.Name</td>
                            <td>@u.ManHours</td>
                            <td>@u.ManMonths</td>
                            <td>@u.TotalManHours</td>
                            <td>P @u.BillingRate.ToString("0,00.00")</td>
                            <td>P @u.DirectCost.ToString("0,00.00")</td>
                            <td>@u.Factor.ToString("0.0#")</td>
                            <td>P @u.BilledToClient.ToString("0,00.00")</td>
                            <td><button type="submit" data-toggle="modal" data-target="#deleteStaff-@u.Id" class="btn btn-danger btn-xs"></button></td>
                        </tr>
                    }
                    <tr>
                        <td></td>
                        <td></td>
                        <td></td>
                        <td></td>
                        <td><i><b>SubTotal</b></i></td>
                        <td>P @Model.TotalStaffDirectCost.ToString("0,00.00")</td>
                        <td></td>
                        <td>P @Model.TotalStaffBilledToClient.ToString("0,00.00")</td>
                    </tr>
                }
            </tbody>
        </table>
    </div>

</div>
<div class="panel panel-default">
    <div class="panel-heading">
        <div class="col-sm-12">
            <div class="col-sm-6">
                <h4>MANAGEMENT FEE</h4>
            </div>
            <div class="col-sm-6">
                <div class="pull-right" style="padding-top:10px">
                    @if (canAccessOM == true || canAccessBD == true)
                    {
                        <button type="submit" class="btn btn-success btn-xs">New</button>
                    }
                </div>
            </div>
        </div>
    </div>
    <div class="panel-body">
        <table id="datatable1" class="table table-striped table-hover">
            <thead>
                <tr>
                    <th>ITEM</th>
                    <th>BILLED TO CLIENT</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td></td>
                    <td></td>
                </tr>
            </tbody>
        </table>
    </div>
</div>
@section BodyArea {
<div id="createStaff" tabindex="-1" role="dialog" aria-labelledby="myModalLabelSmall" aria-hidden="true" class="modal fade">
    <div class="modal-dialog">
        @using (Html.BeginForm("CreateStaff", "Proposal", FormMethod.Post, new { enctype = "multipart/form-data" }))
        {
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" data-dismiss="modal" aria-label="Close" class="close">
                        <span aria-hidden="true"> </span>
                    </button>
                    <h4 id="myModalLabelSmall" class="modal-title">New Staff</h4>
                </div>
                <div class="modal-body">
                    @Html.AntiForgeryToken()
                    @Html.Partial("_Staff", new ProposalStaffModel { ProposalId = Model.Id })
                </div>
                <div class="modal-footer">
                    <button type="submit" class="btn btn-success btn-xs">Save</button>
                    <a href="" type="button" class="btn btn-info btn-xs" data-dismiss="modal">No</a>
                </div>
            </div>
        }
    </div>
</div>
 @foreach (var staff in Model.ProposalStaffs)
 {
<div id="deleteStaff-@staff.Id" tabindex="-1" role="dialog" aria-labelledby="myModalLabelSmall" aria-hidden="true" class="modal fade">
    <div class="modal-dialog modal-sm">
        @using (Html.BeginForm("DeleteStaff", "Proposal", new { @id = staff.Id }, FormMethod.Post))
        {
            @Html.AntiForgeryToken()
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" data-dismiss="modal" aria-label="Close" class="close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                    <h4 id="myModalLabelSmall" class="modal-title">Delete</h4>
                </div>
                <div class="modal-body"><span>Are you sure you want to delete this staff?</span></div>
                <div class="modal-footer">
                    <button type="submit" class="btn btn-success btn-xs">Yes</button>
                    <a href="" type="button" class="btn btn-info btn-xs" data-dismiss="modal">No</a>
                </div>
            </div>
        }
    </div>
</div>
     }
 }

@section Styles {
    @Styles.Render("~/bundles/datatablesCss")
}
@section Scripts {
    @Scripts.Render("~/bundles/datatables")
    @Scripts.Render("~/bundles/demoDatatable")
    @Scripts.Render("~/bundles/notify")
    <script type="text/javascript">
        $(document).ready(function () {
            if ('@TempData["Error"]' != "") {
                $.notify('@TempData["Error"]', "danger");
            }
            if ('@TempData["Success"]' != "") {
                $.notify('@TempData["Success"]', "success");
            }
            if ('@TempData["Info"]' != "") {
                $.notify('@TempData["Info"]', "info");
            }
            if ('@TempData["Warning"]' != "") {
                $.notify('@TempData["Warning"]', "warning");
            }
        });
    </script>
}
